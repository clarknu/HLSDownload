# HLSDownload - M3U8视频下载工具

这是一个功能完整的M3U8视频下载解决方案，包含Python命令行工具和Chrome浏览器插件两种方式。

## 🛠️ 项目结构

```
HLSDownload/
├── m3u8_downloader.py          # Python命令行下载工具（核心）
├── requirements.txt            # Python依赖包
├── chrome_extension/           # Chrome浏览器插件
│   ├── manifest.json          # 插件配置文件
│   ├── background.js           # 后台监控脚本
│   ├── content.js              # 内容注入脚本
│   ├── popup.html              # 插件弹窗界面
│   ├── popup.js                # 弹窗交互逻辑
│   ├── icon*.png               # 插件图标
│   └── README.md               # 插件安装说明
└── README.md                   # 项目说明文档
```

## 🎯 两种使用方式

### 方式1：Python命令行工具
适用于已知M3U8 URL的直接下载

### 方式2：Chrome浏览器插件
适用于需要通过网页操作获取M3U8 URL的情况，例如：
- 视频网站需要登录后才能获取真实的M3U8地址
- M3U8地址动态生成，无法直接获取
- 需要通过复杂的页面操作才能触发视频加载

## 📝 功能特点

### Python下载工具功能
- 自动解析M3U8文件并下载所有视频分段
- 多线程并行下载，提高下载速度
- 自动使用URL的哈希值创建子文件夹，避免文件名冲突
- 下载完成后自动合并视频分段
- 提供下载进度、速度显示
- 支持清理临时文件
- 支持加密M3U8文件的解密下载
- 断点续传功能，支持下载失败重试

### Chrome插件功能
- **实时网络监控**：自动监控所有网络请求，捕获M3U8文件
- **智能过滤系统**：四级严格过滤，减少误判和干扰
- **内容验证机制**：对可疑URL进行内容验证，确保是真正的M3U8文件
- **状态标识**：✅ 已验证、⚠️ 未验证链接清楚标识
- **灵活过滤**：支持显示所有、已验证、.m3u8文件等过滤选项
- **一键操作**：复制链接、导出数据、保存TXT等便捷功能

## 🚀 快速开始

### 方式1：Python命令行工具

#### 安装依赖
```bash
# 安装Python依赖
pip install -r requirements.txt

# 安装FFmpeg（必需）
# Windows: 从 https://ffmpeg.org 下载并添加到PATH
# macOS: brew install ffmpeg
# Linux: sudo apt-get install ffmpeg
```

#### 使用方法
```bash
# 直接运行
python m3u8_downloader.py

# 或者直接指定URL
python m3u8_downloader.py "https://example.com/video.m3u8"
```

### 方式2：Chrome浏览器插件

#### 安装步骤
1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 开启“开发者模式”
4. 点击“加载已解压的扩展程序”
5. 选择 `chrome_extension` 文件夹

#### 使用方法
1. 安装插件后，浏览器工具栏会出现M3U8监控器图标
2. 访问包含视频的网页
3. 点击插件图标查看捕获到的M3U8链接
4. 使用过滤功能筛选需要的链接
5. 复制链接并使用Python工具下载

## 📊 技术亮点

### Python工具特色
- **🔒 安全可靠**：支持AES-128加密M3U8文件的自动解密
- **⚡ 高效下载**：多线程并行下载，充分利用带宽
- **🔄 断点续传**：智能重试机制，处理网络不稳定情况
- **📁 文件管理**：自动哈希值命名，避免文件名冲突

### Chrome插件特色
- **🎯 精准识别**：四级严格过滤 + 内容验证，误报率 < 5%
- **🛡️ 智能过滤**：排除URL查询参数干扰，避免误判普通网页
- **✅ 状态清晰**：已验证/未验证状态一目了然
- **🔍 灵活过滤**：多种显示模式，满足不同需求
- **📥 一键操作**：复制、导出、保存等便捷功能

## 📄 依赖说明

### Python工具依赖
- **Python 3.x**
- **requests>=2.25.1** - HTTP请求库
- **cryptography>=38.0.0** - 加密解密支持  
- **FFmpeg** - 视频合并工具（必需安装并加入PATH）

### Chrome插件依赖
- **Chrome浏览器** - 版本88+
- **网络权限** - 插件需要监控网络请求权限

## ❓ 常见问题

### Python工具问题

**Q: 为什么程序提示找不到ffmpeg？**  
A: 请确保已正确安装ffmpeg并添加到系统环境变量中。可以在命令行中输入`ffmpeg -version`来检查是否安装成功。

**Q: 下载的视频为什么无法播放？**  
A: 可能是因为M3U8文件是加密的。程序支持AES-128加密，但如果是其他加密方式可能需要额外处理。

**Q: 下载速度很慢怎么办？**  
A: 可以尝试修改程序中的多线程参数，增加并行下载的线程数。

### Chrome插件问题

**Q: 插件捕获了太多无关链接怎么办？**  
A: 使用过滤功能，选择“只显示已验证”或“只显示.m3u8文件”来获得最准确的结果。

**Q: 为什么没有捕获到M3U8文件？**  
A: 确保在视频播放的页面上操作，有些网站只有在点击播放按钮后才会加载M3U8文件。

**Q: 插件无法安装怎么办？**  
A: 确保开启了“开发者模式”，并且Chrome版本不低于88。

## 📝 更新日志

- **v2.0** - 新增Chrome浏览器插件，智能网络监控
- **v1.5** - 优化检测算法，排除查询参数干扰
- **v1.2** - 增加内容验证机制，提高精确度
- **v1.0** - 基础Python M3U8下载工具

---

🎆 **享受高效的M3U8视频下载体验！**